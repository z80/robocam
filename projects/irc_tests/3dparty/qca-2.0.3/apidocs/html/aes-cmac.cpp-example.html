<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Qt Cryptographic Architecture: aes-cmac.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>aes-cmac.cpp</h1><p>This example shows how to implement a client side "provider".There are three important parts to this:</p>
<ul>
<li>the class derived from <a class="el" href="classQCA_1_1Provider.html" title="Algorithm provider.">QCA::Provider</a> (in this example called "ClientSideProvider"), that generates the context class</li>
<li>one or more context classes (in this example only one, implementing AES-CMAC, called "AESCMACContext")</li>
<li>a call to <a class="el" href="namespaceQCA.html#a62a0e1e519e664e2db003c14715f1125" title="Add a provider to the current list of providers.">QCA::insertProvider</a>, to add the <a class="el" href="classQCA_1_1Provider.html" title="Algorithm provider.">QCA::Provider</a> subclass into <a class="el" href="namespaceQCA.html" title="QCA - the Qt Cryptographic Architecture.">QCA</a></li>
</ul>
<div class="fragment"><pre class="fragment"><span class="comment">/*</span>
<span class="comment"> Copyright (C) 2006 Brad Hards &lt;bradh@frogmouth.net&gt;</span>
<span class="comment"></span>
<span class="comment"> Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="comment"> of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="comment"> in the Software without restriction, including without limitation the rights</span>
<span class="comment"> to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="comment"> copies of the Software, and to permit persons to whom the Software is</span>
<span class="comment"> furnished to do so, subject to the following conditions:</span>
<span class="comment"></span>
<span class="comment"> The above copyright notice and this permission notice shall be included in</span>
<span class="comment"> all copies or substantial portions of the Software.</span>
<span class="comment"></span>
<span class="comment"> THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="comment"> IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="comment"> FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE</span>
<span class="comment"> AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN</span>
<span class="comment"> AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
<span class="comment"> CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span>
<span class="comment">*/</span>

<span class="comment">// QtCrypto has the declarations for all of QCA</span>
<span class="preprocessor">#include &lt;QtCrypto&gt;</span>

<span class="preprocessor">#include &lt;QCoreApplication&gt;</span>
<span class="preprocessor">#include &lt;QDebug&gt;</span>

<span class="keyword">class </span>AESCMACContext : <span class="keyword">public</span> QCA::MACContext
{
<span class="keyword">public</span>:
    AESCMACContext(<a name="_a0"></a><a class="code" href="classQCA_1_1Provider.html" title="Algorithm provider.">QCA::Provider</a> *p) : <a name="_a1"></a><a class="code" href="classQCA_1_1MACContext.html" title="Message authentication code provider.">QCA::MACContext</a>(p, <span class="stringliteral">&quot;cmac(aes)&quot;</span>)
    {
    }

    ~AESCMACContext()
    {
    }


    <span class="comment">// Helper to left shift an arbitrary length array</span>
    <span class="comment">// This is heavily based on the example in the I-D.</span>
    <a name="_a2"></a><a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> leftShift(<span class="keyword">const</span> <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> &amp;array)
    {
        <span class="comment">// We create an output of the same size as the input</span>
        <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> out(array.<a name="a3"></a><a class="code" href="classQCA_1_1SecureArray.html#a6414d576761db18707321698bd4cb401" title="Returns the number of bytes in the array.">size</a>());
        <span class="comment">// We handle one byte at a time - this is the high bit</span>
        <span class="comment">// from the previous byte.</span>
        <span class="keywordtype">int</span> overflow = 0;

        <span class="comment">// work through each byte.</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = array.<a class="code" href="classQCA_1_1SecureArray.html#a6414d576761db18707321698bd4cb401" title="Returns the number of bytes in the array.">size</a>() -1; i &gt;= 0; --i) {
            <span class="comment">// do the left shift on this byte.</span>
            out[i] = array[i] &lt;&lt; 1;
            <span class="comment">// make the low bit on this byte be the high bit</span>
            <span class="comment">// from the previous byte.</span>
            out[i] |= overflow;
            <span class="comment">// save the high bit for next time</span>
            overflow = (array[i] &amp; 0x80) ? 1 : 0;
        }
        <span class="keywordflow">return</span> out;
    }


    <span class="comment">// Helper to XOR two arrays - must be same length</span>
    <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> xorArray(<span class="keyword">const</span> <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> &amp;array1,
                          <span class="keyword">const</span> <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> &amp;array2)
    {
        <span class="keywordflow">if</span> (array1.<a class="code" href="classQCA_1_1SecureArray.html#a6414d576761db18707321698bd4cb401" title="Returns the number of bytes in the array.">size</a>() != array2.<a class="code" href="classQCA_1_1SecureArray.html#a6414d576761db18707321698bd4cb401" title="Returns the number of bytes in the array.">size</a>())
            <span class="comment">// empty array</span>
            <span class="keywordflow">return</span> <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a>();

        <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> result(array1.<a class="code" href="classQCA_1_1SecureArray.html#a6414d576761db18707321698bd4cb401" title="Returns the number of bytes in the array.">size</a>());

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; array1.<a class="code" href="classQCA_1_1SecureArray.html#a6414d576761db18707321698bd4cb401" title="Returns the number of bytes in the array.">size</a>(); ++i)
            result[i] = array1[i] ^ array2[i];

        <span class="keywordflow">return</span> result;
    }


    <span class="keywordtype">void</span> setup(<span class="keyword">const</span> <a name="_a4"></a><a class="code" href="classQCA_1_1SymmetricKey.html" title="Container for keys for symmetric encryption algorithms.">QCA::SymmetricKey</a> &amp;key)
    {
        <span class="comment">// We might not have a real key, since this can get called</span>
        <span class="comment">// from the constructor.</span>
        <span class="keywordflow">if</span> (key.<a class="code" href="classQCA_1_1SecureArray.html#a6414d576761db18707321698bd4cb401" title="Returns the number of bytes in the array.">size</a>() == 0)
            <span class="keywordflow">return</span>;

        m_key = key;
        <span class="comment">// Generate the subkeys</span>
        <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> const_Zero(16);
        <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> const_Rb(16);
        const_Rb[15] = (char)0x87;

        m_X = const_Zero;
        m_residual = <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a>();

        <span class="comment">// Figure 2.2, step 1.</span>
        <a name="_a5"></a><a class="code" href="classQCA_1_1Cipher.html" title="General class for cipher (encryption / decryption) algorithms.">QCA::Cipher</a> aesObj(<a name="_a6"></a><a class="codeRef" doxygen="qt.tag:" href="qstring.html">QString</a>(<span class="stringliteral">&quot;aes128&quot;</span>),
                           <a name="a7"></a><a class="code" href="classQCA_1_1Cipher.html#a55df34874dc7565d7de238d2d742d66ba2242c6ac6d37ac39d20d85486b113dbb" title="operate in Electronic Code Book mode">QCA::Cipher::ECB</a>, <a name="a8"></a><a class="code" href="classQCA_1_1Cipher.html#aeafc444370fbd6d1457580da2f00c52ba402325f324be592311fcfe5ea0526747" title="Default for cipher-mode.">QCA::Cipher::DefaultPadding</a>,
                           <a name="a9"></a><a class="code" href="namespaceQCA.html#a8e5d1994b00ea69c9a598f93cd0990cea7d1fca4b5ac95d3b9422a305814c067a" title="Operate in the &amp;quot;forward&amp;quot; direction; for example, encrypting.">QCA::Encode</a>, key);
        <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> L = aesObj.<a name="a10"></a><a class="code" href="classQCA_1_1Filter.html#a17cd73e8444960a4fa6cbebda400e97a" title="Perform an &amp;quot;all in one&amp;quot; update, returning the result.">process</a>(const_Zero);

        <span class="comment">// Figure 2.2, step 2</span>
        <span class="keywordflow">if</span> (0 == (L[0] &amp; 0x80))
            m_k1 = leftShift(L);
        <span class="keywordflow">else</span>
            m_k1 = xorArray(leftShift(L), const_Rb);

        <span class="comment">// Figure 2.2, step 3</span>
        <span class="keywordflow">if</span> (0 == (m_k1[0] &amp; 0x80))
            m_k2 = leftShift(m_k1);
        <span class="keywordflow">else</span>
            m_k2 = xorArray(leftShift(m_k1), const_Rb);
    }

    <a name="_a11"></a><a class="code" href="classQCA_1_1Provider_1_1Context.html" title="Internal context class used for the plugin.">QCA::Provider::Context</a> *clone()<span class="keyword"> const</span>
<span class="keyword">    </span>{
        <span class="keywordflow">return</span> <span class="keyword">new</span> AESCMACContext(*<span class="keyword">this</span>);
    }

    <span class="keywordtype">void</span> clear()
    {
        setup(m_key);
    }

    <a name="_a12"></a><a class="code" href="classQCA_1_1KeyLength.html" title="Simple container for acceptable key lengths.">QCA::KeyLength</a> keyLength()<span class="keyword"> const</span>
<span class="keyword">    </span>{
        <span class="keywordflow">return</span> <a class="code" href="classQCA_1_1KeyLength.html" title="Simple container for acceptable key lengths.">QCA::KeyLength</a>(16, 16, 1);
    }

    <span class="comment">// This is a bit different to the way the I-D does it,</span>
    <span class="comment">// to allow for multiple update() calls.</span>
    <span class="keywordtype">void</span> update(<span class="keyword">const</span> <a name="_a13"></a><a class="code" href="classQCA_1_1MemoryRegion.html" title="Array of bytes that may be optionally secured.">QCA::MemoryRegion</a> &amp;a)
    {
        <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> bytesToProcess = m_residual + a;
        <span class="keywordtype">int</span> blockNum;
        <span class="comment">// note that we don&#39;t want to do the last full block here, because</span>
        <span class="comment">// it needs special treatment in final().</span>
        <span class="keywordflow">for</span> (blockNum = 0; blockNum &lt; ((bytesToProcess.<a class="code" href="classQCA_1_1SecureArray.html#a6414d576761db18707321698bd4cb401" title="Returns the number of bytes in the array.">size</a>()-1)/16); ++blockNum) {
            <span class="comment">// copy a block of data</span>
            <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> thisBlock(16);
            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> yalv = 0; yalv &lt; 16; ++yalv)
                thisBlock[yalv] = bytesToProcess[blockNum*16 + yalv];

            m_Y = xorArray(m_X, thisBlock);

            <a class="code" href="classQCA_1_1Cipher.html" title="General class for cipher (encryption / decryption) algorithms.">QCA::Cipher</a> aesObj(<a class="codeRef" doxygen="qt.tag:" href="qstring.html">QString</a>(<span class="stringliteral">&quot;aes128&quot;</span>),
                               <a class="code" href="classQCA_1_1Cipher.html#a55df34874dc7565d7de238d2d742d66ba2242c6ac6d37ac39d20d85486b113dbb" title="operate in Electronic Code Book mode">QCA::Cipher::ECB</a>, <a class="code" href="classQCA_1_1Cipher.html#aeafc444370fbd6d1457580da2f00c52ba402325f324be592311fcfe5ea0526747" title="Default for cipher-mode.">QCA::Cipher::DefaultPadding</a>,
                               <a class="code" href="namespaceQCA.html#a8e5d1994b00ea69c9a598f93cd0990cea7d1fca4b5ac95d3b9422a305814c067a" title="Operate in the &amp;quot;forward&amp;quot; direction; for example, encrypting.">QCA::Encode</a>, m_key);
            m_X = aesObj.<a class="code" href="classQCA_1_1Filter.html#a17cd73e8444960a4fa6cbebda400e97a" title="Perform an &amp;quot;all in one&amp;quot; update, returning the result.">process</a>(m_Y);
        }
        <span class="comment">// This can be between 1 and 16</span>
        <span class="keywordtype">int</span> numBytesLeft = bytesToProcess.<a class="code" href="classQCA_1_1SecureArray.html#a6414d576761db18707321698bd4cb401" title="Returns the number of bytes in the array.">size</a>() - 16*blockNum;
        <span class="comment">// we copy the left over part</span>
        m_residual.resize(numBytesLeft);
        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> yalv = 0; yalv &lt; numBytesLeft; ++yalv)
            m_residual[yalv] = bytesToProcess[blockNum*16 + yalv];
    }

    <span class="keywordtype">void</span> <span class="keyword">final</span>( <a class="code" href="classQCA_1_1MemoryRegion.html" title="Array of bytes that may be optionally secured.">QCA::MemoryRegion</a> *out)
    {
        <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> lastBlock;
        <span class="keywordtype">int</span> numBytesLeft = m_residual.<a class="code" href="classQCA_1_1SecureArray.html#a6414d576761db18707321698bd4cb401" title="Returns the number of bytes in the array.">size</a>();

        <span class="keywordflow">if</span> ( numBytesLeft != 16 ) {
            <span class="comment">// no full block, so we have to pad.</span>
            m_residual.resize(16);
            m_residual[numBytesLeft] = (char)0x80;
            lastBlock = xorArray(m_residual, m_k2);
        } <span class="keywordflow">else</span> {
            <span class="comment">// this is a full block - no padding</span>
            lastBlock = xorArray(m_residual, m_k1);
        }
        m_Y = xorArray(m_X, lastBlock);
        <a class="code" href="classQCA_1_1Cipher.html" title="General class for cipher (encryption / decryption) algorithms.">QCA::Cipher</a> aesObj(<a class="codeRef" doxygen="qt.tag:" href="qstring.html">QString</a>(<span class="stringliteral">&quot;aes128&quot;</span>),
                           <a class="code" href="classQCA_1_1Cipher.html#a55df34874dc7565d7de238d2d742d66ba2242c6ac6d37ac39d20d85486b113dbb" title="operate in Electronic Code Book mode">QCA::Cipher::ECB</a>, <a class="code" href="classQCA_1_1Cipher.html#aeafc444370fbd6d1457580da2f00c52ba402325f324be592311fcfe5ea0526747" title="Default for cipher-mode.">QCA::Cipher::DefaultPadding</a>,
                           <a class="code" href="namespaceQCA.html#a8e5d1994b00ea69c9a598f93cd0990cea7d1fca4b5ac95d3b9422a305814c067a" title="Operate in the &amp;quot;forward&amp;quot; direction; for example, encrypting.">QCA::Encode</a>, m_key);
        *out = aesObj.<a class="code" href="classQCA_1_1Filter.html#a17cd73e8444960a4fa6cbebda400e97a" title="Perform an &amp;quot;all in one&amp;quot; update, returning the result.">process</a>(m_Y);

    }

<span class="keyword">protected</span>:
    <span class="comment">// first subkey</span>
    <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> m_k1;
    <span class="comment">// second subkey</span>
    <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> m_k2;
    <span class="comment">// main key</span>
    <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> m_key;

    <span class="comment">// state</span>
    <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> m_X;
    <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> m_Y;

    <span class="comment">// partial block that we can&#39;t do yet</span>
    <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> m_residual;
};

<span class="keyword">class </span>ClientSideProvider : <span class="keyword">public</span> QCA::Provider
{
<span class="keyword">public</span>:
        <span class="keywordtype">int</span> <a name="a14"></a><a class="code" href="qca__core_8h.html#a02290b5ce16e32abc64745bb8d9c5520" title="The current version of QCA.">qcaVersion</a>()<span class="keyword"> const</span>
<span class="keyword">        </span>{
                <span class="keywordflow">return</span> <a name="a15"></a><a class="code" href="qca__core_8h.html#ae06e7cc07f44561939fb8250825638be" title="The current version of QCA.">QCA_VERSION</a>;
        }

        <a class="codeRef" doxygen="qt.tag:" href="qstring.html">QString</a> name()<span class="keyword"> const</span>
<span class="keyword">        </span>{
                <span class="keywordflow">return</span> <span class="stringliteral">&quot;exampleClientSideProvider&quot;</span>;
        }

        <a name="_a16"></a><a class="codeRef" doxygen="qt.tag:" href="qstringlist.html">QStringList</a> features()<span class="keyword"> const</span>
<span class="keyword">        </span>{
                <a class="codeRef" doxygen="qt.tag:" href="qstringlist.html">QStringList</a> list;
                list += <span class="stringliteral">&quot;cmac(aes)&quot;</span>;
                <span class="comment">// you can add more features in here, if you have some.</span>
                <span class="keywordflow">return</span> list;
        }

        Provider::Context *createContext(<span class="keyword">const</span> <a class="codeRef" doxygen="qt.tag:" href="qstring.html">QString</a> &amp;type)
        {
            <span class="keywordflow">if</span>(type == <span class="stringliteral">&quot;cmac(aes)&quot;</span>)
                <span class="keywordflow">return</span> <span class="keyword">new</span> AESCMACContext(<span class="keyword">this</span>);
            <span class="comment">// else if (type == some other feature)</span>
            <span class="comment">//  return some other context.</span>
            <span class="keywordflow">else</span>
                <span class="keywordflow">return</span> 0;
        }
};


<span class="comment">// AES CMAC is a Message Authentication Code based on a block cipher</span>
<span class="comment">// instead of the more normal keyed hash.</span>
<span class="comment">// See RFC 4493 &quot;The AES-CMAC Algorithm&quot;</span>
<span class="keyword">class </span>AES_CMAC: <span class="keyword">public</span> QCA::MessageAuthenticationCode
{
<span class="keyword">public</span>:
    AES_CMAC(<span class="keyword">const</span> <a class="code" href="classQCA_1_1SymmetricKey.html" title="Container for keys for symmetric encryption algorithms.">QCA::SymmetricKey</a> &amp;key = <a class="code" href="classQCA_1_1SymmetricKey.html" title="Container for keys for symmetric encryption algorithms.">QCA::SymmetricKey</a>(),
             <span class="keyword">const</span> <a class="codeRef" doxygen="qt.tag:" href="qstring.html">QString</a> &amp;provider = <a class="codeRef" doxygen="qt.tag:" href="qstring.html">QString</a>()):
        QCA::MessageAuthenticationCode( <span class="stringliteral">&quot;cmac(aes)&quot;</span>, key, provider)
    {}
};


<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
    <span class="comment">// the Initializer object sets things up, and</span>
    <span class="comment">// also does cleanup when it goes out of scope</span>
    <a name="_a17"></a><a class="code" href="classQCA_1_1Initializer.html" title="Convenience method for initialising and cleaning up QCA.">QCA::Initializer</a> <a name="a18"></a><a class="code" href="namespaceQCA.html#a1de90bf113c54c9e4ffdc5ad784ce629" title="Initialise QCA.">init</a>;

    qDebug() &lt;&lt; <span class="stringliteral">&quot;This example shows AES CMAC&quot;</span>;

    <a name="_a19"></a><a class="codeRef" doxygen="qt.tag:" href="qcoreapplication.html">QCoreApplication</a> app(argc, argv);

    <span class="keywordflow">if</span>( ! <a name="a20"></a><a class="code" href="namespaceQCA.html#a833c9f215544113d52a3a52eedc58620" title="Test if a capability (algorithm) is available.">QCA::isSupported</a>(<span class="stringliteral">&quot;aes128-ecb&quot;</span>) ) {
        qDebug() &lt;&lt; <span class="stringliteral">&quot;AES not supported!&quot;</span>;
    }

    <span class="keywordflow">if</span> ( <a name="a21"></a><a class="code" href="namespaceQCA.html#a62a0e1e519e664e2db003c14715f1125" title="Add a provider to the current list of providers.">QCA::insertProvider</a>(<span class="keyword">new</span> ClientSideProvider, 0) )
        qDebug() &lt;&lt; <span class="stringliteral">&quot;Inserted our provider&quot;</span>;
    <span class="keywordflow">else</span>
        qDebug() &lt;&lt; <span class="stringliteral">&quot;our provider could not be added&quot;</span>;

    <span class="comment">// We should check AES CMAC is supported before using it.</span>
    <span class="keywordflow">if</span>( ! <a class="code" href="namespaceQCA.html#a833c9f215544113d52a3a52eedc58620" title="Test if a capability (algorithm) is available.">QCA::isSupported</a>(<span class="stringliteral">&quot;cmac(aes)&quot;</span>) ) {
        qDebug() &lt;&lt; <span class="stringliteral">&quot;AES CMAC not supported!&quot;</span>;
    } <span class="keywordflow">else</span> {
        <span class="comment">// create the required object</span>
        AES_CMAC cmacObject;

        <span class="comment">// create the key</span>
        <a class="code" href="classQCA_1_1SymmetricKey.html" title="Container for keys for symmetric encryption algorithms.">QCA::SymmetricKey</a> key(<a name="a22"></a><a class="code" href="namespaceQCA.html#a8cde84f93941c71dc555f83e293df4a8" title="Convert a QString containing a hexadecimal representation of a byte array into a...">QCA::hexToArray</a>(<span class="stringliteral">&quot;2b7e151628aed2a6abf7158809cf4f3c&quot;</span>));

        <span class="comment">// set the MAC to use the key</span>
        cmacObject.setup(key);

        <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> message = <a class="code" href="namespaceQCA.html#a8cde84f93941c71dc555f83e293df4a8" title="Convert a QString containing a hexadecimal representation of a byte array into a...">QCA::hexToArray</a>(<span class="stringliteral">&quot;6bc1bee22e409f96e93d7e117393172a&quot;</span>
                                               <span class="stringliteral">&quot;ae2d8a571e03ac9c9eb76fac45af8e51&quot;</span>
                                               <span class="stringliteral">&quot;30c81c46a35ce411e5fbc1191a0a52ef&quot;</span>
                                               <span class="stringliteral">&quot;f69f2445df4f9b17ad2b417be66c3710&quot;</span>);
        <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> message1(message);
        message1.resize(0);
        qDebug();
        qDebug() &lt;&lt; <span class="stringliteral">&quot;Message1: &quot;</span> &lt;&lt; <a name="a23"></a><a class="code" href="namespaceQCA.html#a5df0264a9d1b8fa52a7bce4aaa49ad4c" title="Convert a byte array to printable hexadecimal representation.">QCA::arrayToHex</a>(message1.toByteArray());
        qDebug() &lt;&lt; <span class="stringliteral">&quot;Expecting:  bb1d6929e95937287fa37d129b756746&quot;</span>;
        qDebug() &lt;&lt; <span class="stringliteral">&quot;AES-CMAC: &quot;</span> &lt;&lt; <a class="code" href="namespaceQCA.html#a5df0264a9d1b8fa52a7bce4aaa49ad4c" title="Convert a byte array to printable hexadecimal representation.">QCA::arrayToHex</a>(cmacObject.process(message1).toByteArray());

        cmacObject.clear();
        <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> message2(message);
        message2.resize(16);
        qDebug();
        qDebug() &lt;&lt; <span class="stringliteral">&quot;Message2: &quot;</span> &lt;&lt; <a class="code" href="namespaceQCA.html#a5df0264a9d1b8fa52a7bce4aaa49ad4c" title="Convert a byte array to printable hexadecimal representation.">QCA::arrayToHex</a>(message2.toByteArray());
        qDebug() &lt;&lt; <span class="stringliteral">&quot;Expecting:  070a16b46b4d4144f79bdd9dd04a287c&quot;</span>;
        qDebug() &lt;&lt; <span class="stringliteral">&quot;AES-CMAC: &quot;</span> &lt;&lt; <a class="code" href="namespaceQCA.html#a5df0264a9d1b8fa52a7bce4aaa49ad4c" title="Convert a byte array to printable hexadecimal representation.">QCA::arrayToHex</a>(cmacObject.process(message2).toByteArray());

        cmacObject.clear();
        <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> message3(message);
        message3.resize(40);
        qDebug();
        qDebug() &lt;&lt; <span class="stringliteral">&quot;Message3: &quot;</span> &lt;&lt; <a class="code" href="namespaceQCA.html#a5df0264a9d1b8fa52a7bce4aaa49ad4c" title="Convert a byte array to printable hexadecimal representation.">QCA::arrayToHex</a>(message3.toByteArray());
        qDebug() &lt;&lt; <span class="stringliteral">&quot;Expecting:  dfa66747de9ae63030ca32611497c827&quot;</span>;
        qDebug() &lt;&lt; <span class="stringliteral">&quot;AES-CMAC  &quot;</span> &lt;&lt; <a class="code" href="namespaceQCA.html#a5df0264a9d1b8fa52a7bce4aaa49ad4c" title="Convert a byte array to printable hexadecimal representation.">QCA::arrayToHex</a>(cmacObject.process(message3).toByteArray());

        cmacObject.clear();
        <a class="code" href="classQCA_1_1SecureArray.html" title="Secure array of bytes.">QCA::SecureArray</a> message4(message);
        message4.resize(64);
        qDebug();
        qDebug() &lt;&lt; <span class="stringliteral">&quot;Message4: &quot;</span> &lt;&lt; <a class="code" href="namespaceQCA.html#a5df0264a9d1b8fa52a7bce4aaa49ad4c" title="Convert a byte array to printable hexadecimal representation.">QCA::arrayToHex</a>(message4.toByteArray());
        qDebug() &lt;&lt; <span class="stringliteral">&quot;Expecting:  51f0bebf7e3b9d92fc49741779363cfe&quot;</span>;
        qDebug() &lt;&lt; <span class="stringliteral">&quot;AES-CMAC: &quot;</span> &lt;&lt; <a class="code" href="namespaceQCA.html#a5df0264a9d1b8fa52a7bce4aaa49ad4c" title="Convert a byte array to printable hexadecimal representation.">QCA::arrayToHex</a>(cmacObject.process(message4).toByteArray());
    }

    <span class="keywordflow">return</span> 0;
}

</pre></div> </div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Sat Nov 27 13:41:18 2010 for Qt Cryptographic Architecture by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
